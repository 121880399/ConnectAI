## 前文提要

上一小节我们讲解了梯度下降法的原理，这一小节我们接着讲解梯度下降法的实现细节。

## 斜率
还记得上一小节中我们举的数学例子吗？我们使用了一个简单的二次函数来模拟梯度下降的过程。通过模拟我们得出了一个结论：

> 想要到达最低点需要往斜率相反的方向走

这里有一个非常关键的点，就是**斜率**。

什么是斜率？

斜率是一个数学概念，用来描述一条直线的倾斜程度。它表示在坐标系中，直线每向右移动一个单位时，垂直方向上移动的单位数。斜率可以是正数、负数、零或未定义（在垂直线上）。斜率通常用符号 m 表示。

![](https://files.mdnice.com/user/70350/f74b33d6-1eb7-42e4-8bec-7759ff982c55.png)

上图中有一条直线，直线上有A（4,5）,B（2,3）两点。求该条直线的斜率。

给定线上的两点，计算斜率m的公式为：

$m = \frac{y_2-y_1}{x_2-x_1}$

在这个公式中：

- ${y_2-y_1}$ 是两点之间的垂直变化（在y轴上的变化）。
- ${x_2-x_1}$ 是两点之间的水平变化（在x轴上的变化）。

应用到以上例子就是：

$m = \frac{3-5}{2-4} = 1$

所以以上直线的斜率为1。

现在问题升级，在一条曲线上有一个点$P_0$,我们要求该点切线的斜率要怎么办？

![](https://files.mdnice.com/user/70350/5f5f4225-60c1-4215-9f2a-2e3cd05aa411.png)

在上图中，橘红色的线$P_0T$是$P_0$的切线。要想求这条切线的斜率，我们可以在曲线上假设一个可以移动的点P。

并且连接$P_0$ ，$P$两点。假设$p_0$点的坐标为($x_0,f(x_0)$),$P$点的坐标为（$x_0+\Delta{x},f(x_0+\Delta{x})$）。

根据刚刚斜率的计算公式我们可以得到：

$\tan \varphi = \frac{\Delta y}{\Delta x} = \frac{f(x_0+\Delta x)- f(x_0)}{(x_0+ \Delta x) - x_0}$

当点$P$沿着曲线逐渐趋向于点$P_0$时，割线$PP_0$逐渐与点$P_0$的切线$P_0T$重合。这时候$\Delta x \to 0$,$\varphi \to \alpha$。

那么$P_0T$的斜率为：

$$\tan \alpha = \lim_{\Delta x \to 0} \frac{f(x_0+\Delta x)- f(x_0)}{\Delta x}$$

而这个公式跟导数的定义完全相同。导数的几何意义就是曲线$y = f(x)$ 在点 $P_0(x_0,f(x_0))$处切线的斜率。

## 导数

到目前为止，我们将求曲线上某点切线的斜率转化为了求该点处函数的导数。为了更好的理解导数，我们将给出导数的完整定义。

函数$y = f(x)$的导函数$f^\prime(x)$的定义如下：

$$ f^\prime(x) = \lim_{\Delta x \to 0} \frac{f(x_0+\Delta x)- f(x_0)}{\Delta x}$$

$$\lim_{\Delta x \to 0}是指当\Delta x无限接近0的意思。$$

例如：当$f(x) = x^2$时，

$$f^\prime(x) = \lim_{\Delta x \to 0} \frac{(x+\Delta x)^2 - x^2}{\Delta x} = \lim_{\Delta x \to 0} \frac{2x\Delta x + (\Delta x)^2}{\Delta x} =  \lim_{\Delta x \to 0} (2x+\Delta x) = 2x$$

那么在x=1处的切线斜率就为2。

我们再来看一个例子：

某跳水运动员从20m高的跳台跳入水中，假设t秒后运动员相对于水面的高度为$h(t) = 5t^2 + 3t + 2$,求t=2s时运动员的速度。

我们都知道，如果要求平均速度，我们只需要用高度除以时间就能得到速度。但是这里求的是瞬时的速度，就没这么简单。

我们可以试着用导数的思想来求解。假设在t=2s后又过了一小段时间，我们将这一小段时间定义为$\Delta t$,那么通过通过h(t)这个函数我们就能得到

在t=2s时运动员距离水面的高度 和 在$t=2s+\Delta t$时运动员距离水面的高度。

这两个高度相减就是t=2s后这一小段时间运动员移动的距离。用距离除以这一小段时间，就是这一小段时间的平均速度。

那么如果这一小段时间非常的小呢？那么这一小段距离的平均速度就可以近视为t=2s的瞬时速度。

$$v = \lim_{\Delta t \to 0} \frac{h(2+ \Delta t) - h(2)}{\Delta t} = \lim_{\Delta t \to 0}  （ 23 + \Delta t）= 23$$

所以t=2s时的瞬时速度就为23。

所以当$\Delta t \to 0 $时，这个极限值就是函数f(t)在t点的瞬时变化率。

我们从导数的定义可以看出来，导数反映了当x发生微小的变化$\Delta x$时，将导致函数f(x)的值发生多大程度上的变化。

对应到神经网络中，我们希望知道对权重进行微小的调整后，输出的结果将发生多大的变化。

## 导数的性质

我们通常将函数y = f(x)的导函数用$f^\prime(x)$表示。但也存在一些其他的表示方法，例如：

$f^\prime(x) = \frac{dy}{dx}$

导数有以下简单的性质：

- $\{f(x)+g(x)\}^ \prime = f^ \prime(x) + g^ \prime(x)$

- $\{cf(x)\}^ \prime = cf^ \prime(x)$

用文字描述就是和的导数等于导数的和，常数倍的导数等于导数的常数倍。

## 导数公式

1.基本函数的导数公式



2.分数函数求导

当函数是分数形式时，求导时可以利用以下求导公式：

$\{ \frac{1}{f(x)}\}^ \prime = - \frac{f^\prime(x)}{\{f(x)\}^2}$

3.Sigmoid函数的导数

Sigmoid函数是神经网络中常用的激活函数。其定义如下：

$\sigma(x) = \frac{1}{1+e^{-x}}$

我们如果使用分数函数求导公式：

$\sigma^ \prime (x) = - \frac{(1+e^{-x})^ \prime}{(1+e^{-x})^2}=\frac{e^{-x}}{(1+e^{-x})^2}=\frac{1+e^{-x}-1}{(1+e^{-x})^2} = \frac{1}{1+e^{-x}} - \frac{1}{(1+e^{-x})^2} = \sigma(x) - \sigma(x)^2 = \sigma(x)(1-\sigma(x))$

我们来看两个简单的例子：

1.对$f(x) = 4x^2 + 2x + 1$求导

$f^\prime(x) = (4x^2)^\prime + (2x)^\prime + (1)^\prime = 8x+ 2$

2.对$f(x) = \sum_{i=1}^3 (x+i)^2$求导

为了直观起见，我们将求和公式展开

$f(x) = (x+1)^2 + (x+2)^2 + (x+3)^2$

接着再对f(x)求导

$f^\prime(x) = 2(x+1)+2(x+2)+2(x+3) = 6x+12$

## 最小值的条件

通过讲解，我们知道了导函数$f^\prime(x)$表示切线的斜率，那么有以下定律：

当函数f(x)在x=a 处取得最小值时，$f^\prime(a) = 0$。

但是请注意，$f^\prime(a) = 0$是函数f(x)在x=a处取得最小值的必要条件，不是充分条件。

我们上一小节中提到的鞍点和局部最小值点就是很好的例子。在这两种情况下，导数（切线斜率）都为0，但是它们都不是最小值点。

## 总结

本小节我们通过梯度下降法中的切线斜率引出了导数，并详细讲解了导数的定义和导数基本性质，以及求导公式。